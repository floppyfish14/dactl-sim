<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        autoCenter: true,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 200 }
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var direction;

    function preload ()
    {
        this.load.setBaseURL('http://localhost:8000/');

        this.load.image('background', 'assets/background.png');
        this.load.image('dactl', 'assets/dactl.png');
        this.load.image('stickman', 'assets/stickman.png');
        this.load.image('ufo', 'assets/ufo.png');
        this.load.image('laser', 'assets/laser.png');
        this.load.image('spear', 'assets/spear.png');
        this.load.image('poop', 'assets/poop.png');
        this.load.image('start', 'assets/start.png');
        this.load.image('spaceBar', 'assets/spaceBar.png')
    }

    function create ()
    {
        poops = this.physics.add.group();
        lasers = this.physics.add.group({allowGravity: false});
        stickpeople = this.physics.add.group();

        // capture mouse for lasers
        game.input.mouse.capture = true;

        // background image
        let bg=this.add.image(0, 0, 'background');

        // automagic scaling
        bg.displayHeight=this.sys.game.config.height;
        bg.scaleX=bg.scaleY;
        bg.y=game.config.height/2;
        bg.x=game.config.width/2;

        // start splash screen
        logo = this.add.image(bg.x, bg.y, 'start');
        startText = this.add.text(bg.x*0.87, bg.y*1.2, 'Press Shift to start', { color: 'black', fontSize: '24px' });
        
        // show some instructions
        let spaceBarImage = this.add.image(game.config.width*0.85, bg.y*0.1, 'spaceBar')

        // player sprite
        player = this.physics.add.sprite(bg.x, bg.y, 'dactl');
        player.setCollideWorldBounds(true);

        // stickman sprites
        stickman = stickpeople.create(bg.x, bg.y, 'stickman');
        stickman.setCollideWorldBounds(true);

        //  Input Events
        mousePointer = this.input;
        cursors = this.input.keyboard.createCursorKeys();
        spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        fKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.F);
        // shoot lasers on mouse click
        this.input.on('pointerdown', function (pointer) {
            var laser = lasers.create(player.x, player.y, 'laser');
            if (direction) {
                laser.setVelocityX(+2000);
            }
            else {
                laser.setVelocityX(-2000);
            }
        }, this);

        // collisions
    }

    function update()
    {
        player.x = mousePointer.x;
        player.y = mousePointer.y;

        if (cursors.shift.isDown) {
            logo.visible = false;
            startText.visible = false;
        }

        if (Phaser.Input.Keyboard.JustDown(fKey)) {
            if (!player.flipX) {
                player.flipX = true;
                direction = true;
            }
            else {
                player.flipX = false;
                direction = false;
            }
        }

        if (Phaser.Input.Keyboard.JustDown(spacebar)) {
            var poop = poops.create(player.x, player.y, 'poop');
            poop.setVelocityY(+300);
        }

        // collision handling
    }

    function killPoop(sprite1, sprite2) {
        sprite1.kill();
        sprite2.kill();
    }
    </script>

</body>
</html>