<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: window.innerWidth-10,
        height: window.innerHeight-10,
        autoCenter: true,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 200 }
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var direction;

    function preload ()
    {
        this.load.setBaseURL('http://localhost:8000/');

        this.load.svg({
            key: 'background',
            url: 'assets/background.svg',
            svgConfig: {
                width: game.config.width,
                height: game.config.height
            }
        });
        this.load.image('dactl', 'assets/dactl.png');
        this.load.image('stickman', 'assets/stickman.png');
        this.load.image('ufo', 'assets/ufo.png');
        this.load.image('laser', 'assets/laser.png');
        this.load.image('spear', 'assets/spear.png');
        this.load.image('poop', 'assets/poop.png');
        this.load.image('start', 'assets/start.png');
    }

    function create ()
    {
        poops = this.physics.add.group();
        lasers = this.physics.add.group({allowGravity: false});
        stickpeople = this.physics.add.group();
        ufos = this.physics.add.group({allowGravity: false});

        // capture mouse for lasers
        game.input.mouse.capture = true;

        // disable right click menu
        this.input.mouse.disableContextMenu();

        // background image
        let bg = this.add.image(0,0,'background');

        // automagic scaling
        // bg.displayHeight=this.sys.game.config.height;
        // bg.scaleX=bg.scaleY;
        bg.y=game.config.height/2;
        bg.x=game.config.width/2;

        // start splash screen
        logo = this.add.image(bg.x, bg.y, 'start');
        startText = this.add.text(bg.x*0.87, bg.y*1.3, 'Press Shift to start', { color: 'black', fontSize: '24px' });
        
        // show someeTexts
        spaceBarText = this.add.text(bg.x*0.92, bg.y*1.5, 'Spacebar = poop');
        fKeyText = this.add.text(bg.x*0.92, bg.y*1.55, 'Right Click = flip');
        mouseText = this.add.text(bg.x*0.92, bg.y*1.60, 'Left Click = laser');

        // player sprite
        player = this.physics.add.sprite(bg.x, bg.y, 'dactl');
        player.setCollideWorldBounds(true);

        // stickman sprites
        stickman = stickpeople.create(bg.x, bg.y, 'stickman');
        stickman.setCollideWorldBounds(true);

        // ufo sprites
        ufo = ufos.create(bg.x, bg.y, 'ufo');
        ufo.setCollideWorldBounds(true);

        //  Input Events
        mousePointer = this.input;
        cursors = this.input.keyboard.createCursorKeys();
        spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        // shoot lasers on mouse click
        this.input.on('pointerdown', function (pointer) {
            
            // flip character if right clicked
            if (pointer.rightButtonDown()) 
            {
                if (!player.flipX) {
                    player.flipX = true;
                    direction = true;
                }
                else {
                    player.flipX = false;
                    direction = false;
                }
            }
            // shoot laser on any other mouse button
            else {
                var laser = lasers.create(player.x, player.y, 'laser');
                if (direction) {
                    laser.setVelocityX(+2000);
                }
                else {
                    laser.setVelocityX(-2000);
                }
            } 
        }, this);
        // collisions
    }

    function update()
    {
        // set player locaton to mouse location
        player.x = mousePointer.x;
        player.y = mousePointer.y;

        // hide start items on shift key press
        if (cursors.shift.isDown) {
            logo.visible = false;
            startText.visible = false;
            mouseText.visible = false;
            spaceBarText.visible = false;
            fKeyText.visible = false;
        }

        // poop on spacebar press
        if (Phaser.Input.Keyboard.JustDown(spacebar)) {
            var poop = poops.create(player.x, player.y, 'poop');
            poop.setVelocityY(+300);
        }

        // collision handling
    }

    // kill poop and sprite on collision
    function killPoop(sprite1, sprite2) {
        sprite1.kill();
        sprite2.kill();
    }
    </script>

</body>
</html>